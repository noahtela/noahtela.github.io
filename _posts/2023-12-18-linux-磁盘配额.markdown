---
layout:     post
title:      "linux-磁盘配额"
subtitle:   " \"linux\""
date:       2023-12-18 16:08:12
author:     "yangsir"
header-img: "img/bg-material.jpg"
catalog: true
tags:
    - 笔记
    - linux学习
    - 云原生

---

> “Yeah It's on. ”


<p id = "build"></p>

## 磁盘配额

作用：对用户在指定文件系统中使用的磁盘空间、文件数量进行限制



需要用到的软件包 xfsprogs



#### 磁盘配额的作用范围

xfs quota 设置的磁盘配额功能，只在指定的文件系统(分区) 内有效，用户使用其他未设置配额的文件系统时，将不受限制。

#### 磁盘配额的限制对象

xfs_quota 主要针对系统中指定的用户账号、组账号进行限制，没有被设置限额的用户或组将不受影响。对组账号设置配额后，组内所有用户使用的磁盘容量、文件数量的总和不能超过限制。

#### 磁盘配额的限制类型:

硬盘容量: 限制用户能够使用的磁盘数据块(block) 大小，也就是限制碰盘空间大小，默认单位为 KB。
文件数量: 限制用户能够拥有的文件个数。quota 通过限制i节点的数量来实现对文件数量的限制。

#### 磁盘配额的限制方法:

软限制:制定一个软性的配额数值(如 480MB、180 个文件)，在固定的宽限期内 (默认为七天) 允许用户暂时超过这个限制，但系统会给出警告信息。

硬限制:指定一个硬性的配额数值(如 500MB、200 个文件)，时绝对禁止用户超过这个限制值得，当达到硬限制值时，系统也会给出警告并禁止继续写入数据。硬限制的配额值应大于相应的软限制的值，否则软限制将失效。

#### 磁盘配额管理：

以支持磁盘配额功能的方式挂载文件系统:
除了内核和 xfs quota 软件支持外，实施磁盘配额功能还有一个前提条件，即指定的分区必须已经挂载且支持磁盘配额功能。让分区支持磁盘配额选项:

- usrquota 选项:支持对用户的磁盘配额
- grpquota 选项:支持对组的磁盘配额

注意：在配置磁盘配额过程中，使用带”-o usrquota, grpquota“选项的 mount 命令重新挂载指定的分区以便增加对用户、组配额功能。需要注意的是 xfs 文件系统**只有首次挂载时才启动磁盘配额功能**。所以不能使用"-o remount"挂载选项。

使用xfs_quoat命令设置磁盘容量，文件数的软硬限制等数值。

格式：xfs_quoat -x -c 'limit -u bsoft=N bhard=N isoft=N ihard=N 用户' 挂载点

-x表示启动专家模式

-c 表示直接调用管理命令，不加-c 命令会执行失败并切入到 xfs quota>交互式工作模式

- bsoft=N 磁盘容量软限制
- bhard-N 磁盘容量硬限制
- isoft=N 文件数量软限制
- ihard=N 文件数量硬限制
